<!DOCTYPE html>
<html>
<head>
    <title>360map2.5m - çœŸã®é¢¨å‘Hå–å¾—æ©Ÿèƒ½</title>
    <style>
        /* (ã‚¹ã‚¿ã‚¤ãƒ«ã¯å‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‹ã‚‰ç¶™æ‰¿ãƒ»èª¿æ•´) */
        body { /* â˜…ä¿®æ­£: ã‚¢ãƒ—ãƒªå…¨ä½“ã®æ–‡å­—ã‚’æ‹¡å¤§â˜… */
            font-size: 110%; 
        }
        #map { height: 65vh; width: 100%; }
        #result { 
            margin-top: 10px; padding: 15px; border: 1px solid #007bff; 
            background-color: #e9f5ff; border-radius: 5px; 
            font-size: 1.1em; /* â˜…ä¿®æ­£: çµæœã‚¨ãƒªã‚¢ã®æ–‡å­—ã‚’æ‹¡å¤§â˜… */
        }
        #result h3 { color: #007bff; }

        /* ã‚»ãƒ³ã‚µãƒ¼çª“ã¨é¢¨å‘Hçª“ã®ã‚³ãƒ³ãƒ†ãƒŠ */
        #sensorContainer { display: flex; gap: 20px; margin-top: 10px; }

        /* ã‚»ãƒ³ã‚µãƒ¼çª“ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #compassWindow {
            flex: 1;
            padding: 15px;
            border: 2px solid #5cb85c;
            background-color: #f0fff0;
            border-radius: 5px;
            text-align: center;
        }
        
        /* â˜…â˜…â˜… é¢¨å‘Hè¡¨ç¤ºçª“ã®ã‚¹ã‚¿ã‚¤ãƒ« â˜…â˜…â˜… */
        #windHWindow {
            flex: 1;
            padding: 15px;
            border: 2px solid #000;
            background-color: #f7f7f7;
            border-radius: 5px;
            text-align: center;
        }
        #windHWindow strong { color: #000; }
        
        #headingRealtime { 
            font-size: 1.8em; /* â˜…ä¿®æ­£: æ–‡å­—ã‚µã‚¤ã‚ºæ‹¡å¤§â˜… */ 
            color: #4CAF50; font-weight: bold; 
        }
        #headingCorrected { 
            font-size: 3em; /* â˜…ä¿®æ­£: æ–‡å­—ã‚µã‚¤ã‚ºæ‹¡å¤§â˜… */ 
            color: #007bff; font-weight: bold; margin-top: 5px; 
        }
        #recordedErrorDisplay { font-weight: bold; color: #FF6347; }
        
        /* â˜…â˜…â˜… é¢¨å‘Hã®æœ€çµ‚çµæœè¡¨ç¤ºã‚¹ã‚¿ã‚¤ãƒ« â˜…â˜…â˜… */
        #windHResultDisplay {
            font-size: 3em; /* â˜…ä¿®æ­£: æ–‡å­—ã‚µã‚¤ã‚ºæ‹¡å¤§â˜… */
            color: #d9534f;
            font-weight: bold;
            margin-top: 10px;
        }

        /* ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #setLocationButton, #captureHeadingButton, #startCompassButton, #captureWindHButton {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            margin-bottom: 10px;
            margin-right: 10px;
        }
        #setLocationButton { background-color: #28a745; color: white; }
        #startCompassButton { background-color: #ffc107; color: black; }
        #captureHeadingButton { background-color: #d9534f; color: white; }
        #captureWindHButton { background-color: #007bff; color: white; } /* é¢¨å‘Hãƒœã‚¿ãƒ³ã®è‰² */

    </style>
</head>
<body>
    <h1>çœŸã®é¢¨å‘Hå–å¾—æ©Ÿèƒ½ (360map2.5m)</h1>

    <button id="setLocationButton">ç¾åœ¨ä½ç½®ã‚’Aç‚¹ã«è¨­å®š</button>
    
    <div id="bPointSelection">
        <strong>Bç‚¹ (ç›®çš„åœ°) ã®é¸æŠ:</strong>
        <label><input type="radio" name="b_option" value="kinjo" checked> é‡‘æ­¦ç«åŠ›ç™ºé›»æ‰€</label> <label><input type="radio" name="b_option" value="gushikawa"> å…·å¿—å·ç«åŠ›ç™ºé›»æ‰€</label>
      
        <label><input type="radio" name="b_option" value="tap"> åœ°å›³ä¸Šã§ã‚¿ãƒƒãƒ—</label>
    </div>
    <p id="bTapInstruction" style="display:none; color: red; font-weight: bold;">**åœ°å›³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦Bç‚¹ã‚’è¨­å®šã—ã¦ãã ã•ã„**</p>

    <div id="result">
        <p class="initial-prompt">Aç‚¹ã¨Bç‚¹ã‚’è¨­å®šå¾Œã€ã€Œæ–¹ä½æ±ºå®šã€ã§**ã‚³ãƒ³ãƒ‘ã‚¹èª¤å·®ã‚’è¨˜éŒ²**ã—ã¦ãã ã•ã„ã€‚</p>
    </div>

    <button id="startCompassButton">æ–¹ä½ã‚»ãƒ³ã‚µãƒ¼ã‚’é–‹å§‹</button>
    <button id="captureHeadingButton" disabled>Bç‚¹ã«ã‚¹ãƒãƒ›ã‚’å‘ã‘ã¦æ–¹ä½ã‚’æ±ºå®šï¼ˆèª¤å·®ã‚’è¨˜éŒ²ï¼‰</button>
    
    <button id="captureWindHButton" disabled>é¢¨å‘Hã«ã‚¹ãƒãƒ›ã‚’å‘ã‘ã€çœŸã®æ–¹ä½ã‚’å–å¾—</button>
    

    <div id="sensorContainer">
        <div id="compassWindow">
            <strong>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ–¹ä½ (æœªè£œæ­£ / è£œæ­£æ¸ˆã¿)</strong>
            <p id="headingRealtime">--</p>
            <p id="headingCorrected">---</p>
            <p style="font-size: 0.9em; margin-top: 10px;">
                **è¨˜éŒ²ã•ã‚ŒãŸèª¤å·®**: <span id="recordedErrorDisplay">æœªè¨˜éŒ²</span>
            </p>
            <p style="font-size: 0.9em;" id="compassStatus">ã‚»ãƒ³ã‚µãƒ¼ã¯åœæ­¢ä¸­ã§ã™ã€‚</p>
        </div>

        <div id="windHWindow">
            <strong>ğŸ¯ è£œæ­£æ¸ˆã¿ é¢¨å‘H (çœŸæ–¹ä½)</strong>
            <p id="windHResultDisplay">---</p>
            <p style="font-size: 0.9em;">
                ï¼ˆã€Œé¢¨å‘Hã‚’å–å¾—ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰
            </p>
        </div>
    </div>


    <div id="map"></div>

    <script>
        const API_KEY = "AIzaSyAHhxSJK-IhYiT9XBRwE1MX7DHhghBQQQk"; 

        const B_POINTS = { kinjo: { lat: 26.4454055, lng: 127.9209787, name: "é‡‘æ­¦ç«åŠ›ç™ºé›»æ‰€ (Bç‚¹)" },
            gushikawa: { lat: 26.3803176, lng: 127.8751869, name: "å…·å¿—å·ç«åŠ›ç™ºé›»æ‰€ (Bç‚¹)" }
        };
        
        let map;
        let currentOriginA = null;
        let currentDestinationB = null;
        let mapTapMode = false;
        
        let markerA = null;
        let markerB = null;
        let polyline = null;

        let lastReadHeading = null; 
        let isCompassRunning = false; 
        let recordedError = null; // è¨˜éŒ²ã•ã‚ŒãŸèª¤å·®ã‚’ä¿æŒã™ã‚‹ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°

        // --- ã‚»ãƒ³ã‚µãƒ¼é–¢é€£ã®é–¢æ•° ---
        
        function toggleCompass() {
            const statusDiv = document.getElementById('compassStatus');
            const startButton = document.getElementById('startCompassButton');
            const captureButton = document.getElementById('captureHeadingButton');
            const windHButton = document.getElementById('captureWindHButton'); // é¢¨å‘Hãƒœã‚¿ãƒ³

            if (isCompassRunning) {
                // åœæ­¢å‡¦ç†
                window.removeEventListener('deviceorientation', handleOrientation);
                isCompassRunning = false;
                startButton.textContent = 'æ–¹ä½ã‚»ãƒ³ã‚µãƒ¼ã‚’é–‹å§‹';
                statusDiv.textContent = 'ã‚»ãƒ³ã‚µãƒ¼ã¯åœæ­¢ä¸­ã§ã™ã€‚';
                captureButton.disabled = true;
                windHButton.disabled = true; // åœæ­¢æ™‚ã¯ç„¡åŠ¹åŒ–
                document.getElementById('headingRealtime').textContent = '--';
                document.getElementById('headingCorrected').textContent = '---';
            } else {
                // é–‹å§‹å‡¦ç†
                if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                    DeviceOrientationEvent.requestPermission()
                        .then(permissionState => {
                            if (permissionState === 'granted') {
                                startSensorLogic(startButton, statusDiv, captureButton, windHButton);
                            } else {
                                statusDiv.textContent = 'ã‚»ãƒ³ã‚µãƒ¼åˆ©ç”¨ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸã€‚è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';
                            }
                        })
                        .catch(console.error);
                } else {
                    startSensorLogic(startButton, statusDiv, captureButton, windHButton);
                }
            }
        }
        
        function startSensorLogic(startButton, statusDiv, captureButton, windHButton) {
            window.addEventListener('deviceorientation', handleOrientation);
            isCompassRunning = true;
            startButton.textContent = 'æ–¹ä½ã‚»ãƒ³ã‚µãƒ¼ã‚’åœæ­¢';
            statusDiv.textContent = 'ã‚»ãƒ³ã‚µãƒ¼ç¨¼åƒä¸­ã€‚';
            captureButton.disabled = false;
            windHButton.disabled = false; // é–‹å§‹æ™‚ã¯æœ‰åŠ¹åŒ–
        }

        function handleOrientation(event) {
            if (event.alpha === null) return;
            lastReadHeading = (360 - event.alpha + 360) % 360; 
            
            document.getElementById('headingRealtime').textContent = `${lastReadHeading.toFixed(1)}Â°`;
            
            // è£œæ­£æ©Ÿèƒ½ã®é©ç”¨ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤ºï¼‰
            if (recordedError !== null) {
                let correctedHeading = lastReadHeading - recordedError;
                correctedHeading = (correctedHeading % 360 + 360) % 360; 

                document.getElementById('headingCorrected').textContent = `${correctedHeading.toFixed(1)}Â°`;
                document.getElementById('compassStatus').textContent = `ã‚»ãƒ³ã‚µãƒ¼ç¨¼åƒä¸­ï¼ˆèª¤å·® ${recordedError.toFixed(2)}Â° è£œæ­£æ¸ˆã¿ï¼‰`;
            } else {
                document.getElementById('headingCorrected').textContent = '---';
                document.getElementById('compassStatus').textContent = 'ã‚»ãƒ³ã‚µãƒ¼ç¨¼åƒä¸­ï¼ˆèª¤å·®æœªè¨˜éŒ²ã®ãŸã‚è£œæ­£ãªã—ï¼‰';
            }
        }
        
        /**
         * é¢¨å‘Hã®æ–¹ä½ã‚’å–å¾—ã—ã€èª¤å·®ã‚’é©ç”¨ã—ã¦çµæœã‚’è¡¨ç¤ºã™ã‚‹
         */
        function captureWindHeading() {
            const windHDisplay = document.getElementById('windHResultDisplay');
            
            if (lastReadHeading === null || !isCompassRunning) {
                windHDisplay.textContent = 'ã‚»ãƒ³ã‚µãƒ¼ã‚’èµ·å‹•ã—ã€å€¤ã‚’èª­ã¿å–ã£ã¦ãã ã•ã„ã€‚';
                return;
            }
            
            const rawWindHeading = lastReadHeading;
            
            if (recordedError === null) {
                windHDisplay.innerHTML = `èª¤å·®æœªè¨˜éŒ²: ${rawWindHeading.toFixed(1)}Â°<br> (è£œæ­£ãªã—)`;
                document.getElementById('windHWindow').style.borderColor = 'red';
                return;
            }

            // èª¤å·®ã‚’å·®ã—å¼•ã„ã¦è£œæ­£å¾Œã®çœŸã®æ–¹ä½ã‚’è¨ˆç®—
            let correctedWindHeading = rawWindHeading - recordedError;
            correctedWindHeading = (correctedWindHeading % 360 + 360) % 360;

            windHDisplay.innerHTML = `${correctedWindHeading.toFixed(1)}Â°`;
            document.getElementById('windHWindow').style.borderColor = '#007bff'; // æˆåŠŸè‰²
            
            document.getElementById('result').innerHTML = `
                <h3>âœ… é¢¨å‘Hã®æ–¹ä½å–å¾—å®Œäº†</h3>
                <p>æœªè£œæ­£å€¤: ${rawWindHeading.toFixed(1)}Â°</p>
                <p>è¨˜éŒ²ã•ã‚ŒãŸèª¤å·®: ${recordedError.toFixed(2)}Â°</p>
                <p><strong>çœŸã®é¢¨å‘H (è£œæ­£å¾Œ):</strong> <span style="font-size: 2em; /* â˜…ä¿®æ­£: æ–‡å­—ã‚µã‚¤ã‚ºæ‹¡å¤§â˜… */ color: #d9534f;">${correctedWindHeading.toFixed(1)}Â°</span></p>
            `;
        }

        /**
         * Bç‚¹ã«ã‚¹ãƒãƒ›ã‚’å‘ã‘ã¦æ–¹ä½ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã€èª¤å·®ã‚’è¨ˆç®—ãƒ»è¨˜éŒ²ã™ã‚‹
         */
        function captureHeading() {
            if (lastReadHeading === null || !currentOriginA || !currentDestinationB) {
                 document.getElementById('result').innerHTML = `<h3>âŒ è¨˜éŒ²å¤±æ•—</h3><p style="color: red;">Aç‚¹/Bç‚¹ã®è¨­å®šã¾ãŸã¯ã‚»ãƒ³ã‚µãƒ¼å€¤ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>`;
                 return;
            }

            const capturedValue = lastReadHeading;
            const trueBearing = calculateBearing(currentOriginA.lat(), currentOriginA.lng(), currentDestinationB.lat(), currentDestinationB.lng());
            
            // èª¤å·®ã‚’è¨ˆç®—ã—ã€æ­£è¦åŒ–
            let error = capturedValue - trueBearing;
            if (error > 180) { error -= 360; } else if (error < -180) { error += 360; }
            
            // èª¤å·®ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«è¨˜éŒ²
            recordedError = error; 
            document.getElementById('recordedErrorDisplay').textContent = `${recordedError.toFixed(2)}Â°`;
            
            let bName = markerB ? markerB.getTitle() : 'ã‚¿ãƒƒãƒ—ä½ç½®';

            // çµæœè¡¨ç¤ºã®æ›´æ–°
            document.getElementById('result').innerHTML = `
                <h3>âœ… ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†ï¼ˆèª¤å·®ã‚’è¨˜éŒ²ï¼‰</h3>
                <p><strong>Aç‚¹ã‹ã‚‰è¦‹ãŸBç‚¹ã®æ–¹ä½ (çœŸã®æ–¹ä½):</strong> 
                <span style="color: #337ab7; font-weight: bold;">${trueBearing.toFixed(2)}Â°</span></p>
                <p><strong>è¨˜éŒ²ã•ã‚ŒãŸæ–¹ä½ (æ±ºå®šå€¤):</strong> 
                <span style="color:#d9534f">${capturedValue.toFixed(2)}Â°</span></p>
                <p style="font-size: 1.5em; color: #FF6347; font-weight: bold;">
                    ğŸ§­ è¨˜éŒ²ã•ã‚ŒãŸã‚³ãƒ³ãƒ‘ã‚¹èª¤å·®: ${error.toFixed(2)}Â°
                </p>
            `;
            // è£œæ­£å¾Œã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤ºã‚’ãƒˆãƒªã‚¬ãƒ¼
            handleOrientation({ alpha: (360 - capturedValue) % 360 }); 
        }

        // --- åœ°ç†çš„ãªæ–¹ä½è¨ˆç®— (å‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨åŒã˜) ---
        
        function calculateBearing(startLat, startLng, endLat, endLng) {
            const R_startLat = startLat * (Math.PI / 180);
            const R_endLat = endLat * (Math.PI / 180);
            const deltaLng = (endLng - startLng) * (Math.PI / 180);

            const y = Math.sin(deltaLng) * Math.cos(R_endLat);
            const x = Math.cos(R_startLat) * Math.sin(R_endLat) - 
                      Math.sin(R_startLat) * Math.cos(R_endLat) * Math.cos(deltaLng);

            let bearingRad = Math.atan2(y, x);
            let bearingDeg = bearingRad * (180 / Math.PI);

            return (bearingDeg + 360) % 360;
        }

        // --- ãƒãƒƒãƒ—æ“ä½œãƒ­ã‚¸ãƒƒã‚¯ (ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¿½åŠ ä»¥å¤–ã¯å‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨åŒã˜) ---
        
        function initMap() {
             map = new google.maps.Map(document.getElementById('map'), {
                zoom: 12, center: B_POINTS.kinjo, /* â˜…ä¿®æ­£: åˆæœŸcenterã‚’kinjoã«å¤‰æ›´â˜… */
            });


            document.getElementById('setLocationButton').addEventListener('click', findCurrentLocation);
            document.getElementById('startCompassButton').addEventListener('click', toggleCompass);
            document.getElementById('captureHeadingButton').addEventListener('click', captureHeading); 
            // â˜…â˜…â˜… æ–°ã—ã„ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ â˜…â˜…â˜…
            document.getElementById('captureWindHButton').addEventListener('click', captureWindHeading); 
            
            document.getElementsByName('b_option').forEach(radio => {
                radio.addEventListener('change', handleBSelectionChange);
            });
            map.addListener('click', handleMapClick);

            setDestinationB(B_POINTS.kinjo); /* â˜…ä¿®æ­£: åˆæœŸBç‚¹ã‚’kinjoã«å¤‰æ›´â˜… */
        }
        
        function handleBSelectionChange(event) {
            const selectedValue = event.target.value;
            document.getElementById('bTapInstruction').style.display = 'none';
            mapTapMode = false;
            
            if (selectedValue === 'tap') {
                document.getElementById('bTapInstruction').style.display = 'block';
                currentDestinationB = null;
                mapTapMode = true;
            } else {
                setDestinationB(B_POINTS[selectedValue]);
            }
            if (currentOriginA) { displayCalculatedBearing(); }
        }
        
        function handleMapClick(event) {
            if (mapTapMode) {
                setDestinationB({ lat: event.latLng.lat(), lng: event.latLng.lng(), name: "ãƒãƒƒãƒ—ã‚¿ãƒƒãƒ—ä½ç½® (Bç‚¹)" });
                mapTapMode = false;
                document.getElementById('bTapInstruction').style.display = 'none';
                document.querySelector('input[name="b_option"][value="tap"]').checked = true;
                if (currentOriginA) { displayCalculatedBearing(); }
            }
        }
        
        function setDestinationB(coords) {
            currentDestinationB = new google.maps.LatLng(coords.lat, coords.lng);
            if (markerB) { markerB.setPosition(currentDestinationB); markerB.setTitle(coords.name); } 
            else { markerB = new google.maps.Marker({ position: currentDestinationB, map: map, title: coords.name, label: 'B', }); }
            if (currentOriginA) { updateMapDisplay(); } else { map.setCenter(currentDestinationB); }
        }
        
        function findCurrentLocation() {
            document.getElementById('result').innerHTML = '<p class="loading">ç¾åœ¨åœ°ã‚’æ¤œå‡ºä¸­ã§ã™...</p>';
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        currentOriginA = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
                        if (markerA) { markerA.setPosition(currentOriginA); } 
                        else {
                            markerA = new google.maps.Marker({
                                position: currentOriginA, map: map, title: "ç¾åœ¨ä½ç½® (Aç‚¹)", label: 'A',
                                icon: { path: google.maps.SymbolPath.CIRCLE, scale: 8, fillColor: '#007bff', fillOpacity: 1, strokeWeight: 0, }
                            });
                        }
                        updateMapDisplay();
                        document.getElementById('setLocationButton').textContent = 'ç¾åœ¨ä½ç½®ã‚’Aç‚¹ã«è¨­å®š (æ›´æ–°)';
                        document.getElementById('result').innerHTML = `<h3>âœ… Aç‚¹è¨­å®šå®Œäº†</h3><p>ç¾åœ¨ä½ç½®ãŒAç‚¹ã¨ã—ã¦è¨­å®šã•ã‚Œã¾ã—ãŸã€‚</p>`;
                        displayCalculatedBearing(); 

                    },
                    (error) => { document.getElementById('result').innerHTML = `<h3>âŒ Aç‚¹è¨­å®šå¤±æ•—</h3><p style="color: red;">ä½ç½®æƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼ã€‚</p>`; }
                );
            } else { document.getElementById('result').innerHTML = `<h3>âŒ Aç‚¹è¨­å®šå¤±æ•—</h3><p style="color: red;">ãƒ–ãƒ©ã‚¦ã‚¶ãŒä½ç½®æƒ…å ±APIã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚</p>`; }
        }
        
        function updateMapDisplay() {
            if (!currentOriginA || !currentDestinationB) { return; }
            if (polyline) { polyline.setMap(null); }
            polyline = new google.maps.Polyline({
                path: [currentOriginA, currentDestinationB], geodesic: true, strokeColor: '#FF0000',
                strokeOpacity: 1.0, strokeWeight: 2, map: map,
            });
            const bounds = new google.maps.LatLngBounds();
            bounds.extend(currentOriginA);
            bounds.extend(currentDestinationB);
            map.fitBounds(bounds);
        }

        function displayCalculatedBearing() {
            if (!currentOriginA || !currentDestinationB) {
                document.getElementById('result').innerHTML = `<h3>å¾…æ©Ÿä¸­...</h3><p>Aç‚¹ã¨Bç‚¹ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚</p>`;
                return;
            }
            
            const trueBearing = calculateBearing(currentOriginA.lat(), currentOriginA.lng(), currentDestinationB.lat(), currentDestinationB.lng());
            let bName = markerB ? markerB.getTitle() : 'ã‚¿ãƒƒãƒ—ä½ç½®';
            const calibrationMessage = recordedError !== null ? 
                `<span style="color: green; font-weight: bold;">èª¤å·® ${recordedError.toFixed(2)}Â° è¨˜éŒ²æ¸ˆã¿ã€‚</span>` : 
                `**æ–¹ä½ã‚’æ±ºå®š**ã—ã¦èª¤å·®ã‚’è¨˜éŒ²ã—ã¦ãã ã•ã„ã€‚`;

            document.getElementById('result').innerHTML = `
                <h3>âœ… æ–¹ä½è¨ˆç®—çµæœ</h3>
                <p><strong>Aç‚¹ã‹ã‚‰è¦‹ãŸBç‚¹ã®æ–¹ä½ (çœŸã®æ–¹ä½):</strong> 
                <span style="font-size: 1.5em; color: #337ab7; font-weight: bold;">${trueBearing.toFixed(2)}Â°</span></p>
                <p>${calibrationMessage}</p>
            `;
        }

    </script>

    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAHhxSJK-IhYiT9XBRwE1MX7DHhghBQQQk&callback=initMap">
    </script>
</body>
</html>