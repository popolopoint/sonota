<!DOCTYPE html>
<html>
<head>
Â  Â  <title>360map-v3.1.2-çœŸã®é¢¨å‘è£œæ­£ã©ã‚“H</title>
Â  Â  <style>
Â  Â  Â  Â  /* (ã‚¹ã‚¿ã‚¤ãƒ«ã¯å‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‹ã‚‰ç¶™æ‰¿ãƒ»èª¿æ•´) */
Â  Â  Â  Â  body {Â 
Â  Â  Â  Â  Â  Â  font-size: 200%; /* å…¨ä½“ã®åŸºæœ¬ã‚µã‚¤ã‚ºã‚’200% */
Â  Â  Â  Â  }
Â  Â  Â  Â  #map { height: 65vh; width: 100%; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* â˜…â˜…â˜…è¿½åŠ : ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã®ã‚¹ã‚¿ã‚¤ãƒ«â˜…â˜…â˜… */
Â  Â  Â  Â  .version-info {
Â  Â  Â  Â  Â  Â  font-size: 0.4em; /* h1ã«å¯¾ã—ã¦å°ã•ãè¡¨ç¤º */
Â  Â  Â  Â  Â  Â  font-weight: normal;
Â  Â  Â  Â  Â  Â  color: #666; /* å°‘ã—è–„ã„è‰²ã§å¼·èª¿ã‚’æŠ‘ãˆã‚‹ */
Â  Â  Â  Â  Â  Â  margin-left: 10px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Bç‚¹é¸æŠã®ãƒ©ãƒ™ãƒ«æ–‡å­—ã‚’å¤§ããã™ã‚‹ */
Â  Â  Â  Â  #bPointSelection {
Â  Â  Â  Â  Â  Â  Â font-size: 1em;
Â  Â  Â  Â  }

Â  Â  Â  Â  #result {Â 
Â  Â  Â  Â  Â  Â  margin-top: 10px; padding: 15px; border: 1px solid #007bff;Â 
Â  Â  Â  Â  Â  Â  background-color: #e9f5ff; border-radius: 5px;Â 
Â  Â  Â  Â  Â  Â  font-size: 1.1em;
Â  Â  Â  Â  }
Â  Â  Â  Â  #result h3 { color: #007bff; }
Â  Â  Â  Â  #result p { font-size: 0.8em; }
Â  Â  Â  Â  .initial-prompt { font-size: 0.9em; }

Â  Â  Â  Â  /* ã‚»ãƒ³ã‚µãƒ¼çª“ã¨é¢¨å‘Hçª“ã®ã‚³ãƒ³ãƒ†ãƒŠ */
Â  Â  Â  Â  #sensorContainer { display: flex; gap: 20px; margin-top: 10px; }

Â  Â  Â  Â  /* ã‚»ãƒ³ã‚µãƒ¼çª“ã®ã‚¹ã‚¿ã‚¤ãƒ« */
Â  Â  Â  Â  #compassWindow {
Â  Â  Â  Â  Â  Â  flex: 1;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  border: 2px solid #5cb85c;
Â  Â  Â  Â  Â  Â  background-color: #f0fff0;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* é¢¨å‘Hè¡¨ç¤ºçª“ã®ã‚¹ã‚¿ã‚¤ãƒ« */
Â  Â  Â  Â  #windHWindow {
Â  Â  Â  Â  Â  Â  flex: 1;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  border: 2px solid #000;
Â  Â  Â  Â  Â  Â  background-color: #f7f7f7;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  #windHWindow strong { color: #000; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #headingRealtime {Â 
Â  Â  Â  Â  Â  Â  font-size: 1.5em;
Â  Â  Â  Â  Â  Â  color: #4CAF50; font-weight: bold;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  #headingCorrected {Â 
Â  Â  Â  Â  Â  Â  font-size: 2.5em;
Â  Â  Â  Â  Â  Â  color: #007bff; font-weight: bold; margin-top: 5px;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  #recordedErrorDisplay { font-weight: bold; color: #FF6347; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* é¢¨å‘Hã®æœ€çµ‚çµæœè¡¨ç¤ºã‚¹ã‚¿ã‚¤ãƒ« */
Â  Â  Â  Â  #windHResultDisplay {
Â  Â  Â  Â  Â  Â  font-size: 2.5em;
Â  Â  Â  Â  Â  Â  color: #d9534f;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
Â  Â  Â  Â  #setLocationButton, #captureHeadingButton, #startCompassButton, #captureWindHButton, #copyWindHButton, #sendWindHButton {Â 
Â  Â  Â  Â  Â  Â  padding: 15px 25px;Â 
Â  Â  Â  Â  Â  Â  font-size: 1.5em;Â 
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  margin-bottom: 15px;Â 
Â  Â  Â  Â  Â  Â  margin-right: 15px;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  #setLocationButton { background-color: #28a745; color: white; }
Â  Â  Â  Â  #startCompassButton { background-color: #ffc107; color: black; }
Â  Â  Â  Â  #captureHeadingButton { background-color: #d9534f; color: white; }
Â  Â  Â  Â  #captureWindHButton { background-color: #007bff; color: white; }Â 
Â  Â  Â  Â  #copyWindHButton { background-color: #5cb85c; color: white; margin-left: 15px; }Â 
Â  Â  Â  Â  /* â˜…â˜…â˜…è¿½åŠ : é€ä¿¡ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«â˜…â˜…â˜… */
Â  Â  Â  Â  #sendWindHButton { background-color: #6610f2; color: white; margin-left: 15px; }
Â  Â  </style>
</head>
<body>
Â  Â  <h1>
Â  Â  Â  Â  çœŸã®é¢¨å‘è£œæ­£ã©ã‚“H
Â  Â  Â  Â  <span class="version-info">(360map-v3.1.2) by Popolo</span>
Â  Â  </h1>

Â  Â  <button id="setLocationButton">ç¾åœ¨ä½ç½®ã‚’Aç‚¹ã«è¨­å®š</button>
Â  Â Â 
Â  Â  <div id="bPointSelection">
Â  Â  Â  Â  <strong>Bç‚¹ (ç›®çš„åœ°) ã®é¸æŠ:</strong>
Â  Â  Â  Â  <label><input type="radio" name="b_option" value="kinjo" checked> é‡‘æ­¦ç«åŠ›ç™ºé›»æ‰€</label>
Â  Â  Â  Â  <label><input type="radio" name="b_option" value="gushikawa"> å…·å¿—å·ç«åŠ›ç™ºé›»æ‰€</label>
Â  Â  Â Â 
Â  Â  Â  Â  <label><input type="radio" name="b_option" value="tap"> åœ°å›³ä¸Šã§ã‚¿ãƒƒãƒ—</label>
Â  Â  </div>
Â  Â  <p id="bTapInstruction" style="display:none; color: red; font-weight: bold;">**åœ°å›³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦Bç‚¹ã‚’è¨­å®šã—ã¦ãã ã•ã„**</p>

Â  Â  <div id="result">
Â  Â  Â  Â  <p class="initial-prompt">Aç‚¹ã¨Bç‚¹ã‚’è¨­å®šå¾Œã€ã€Œæ–¹ä½æ±ºå®šã€ã§**ã‚³ãƒ³ãƒ‘ã‚¹èª¤å·®ã‚’è¨˜éŒ²**ã—ã¦ãã ã•ã„ã€‚</p>
Â  Â  </div>

Â  Â  <button id="startCompassButton">æ–¹ä½ã‚»ãƒ³ã‚µãƒ¼ã‚’é–‹å§‹</button>
Â  Â  <button id="captureHeadingButton" disabled>Bç‚¹ã«ã‚¹ãƒãƒ›ã‚’å‘ã‘ã¦æ–¹ä½ã‚’æ±ºå®š</button>
Â  Â Â 
Â  Â  <button id="captureWindHButton" disabled>é¢¨å‘Hã«ã‚¹ãƒãƒ›ã‚’å‘ã‘ã€çœŸã®æ–¹ä½ã‚’å–å¾—</button>
Â  Â Â 
Â  Â  <button id="copyWindHButton" disabled>è£œæ­£æ¸ˆã¿é¢¨å‘Hã‚’ã‚³ãƒ”ãƒ¼</button>
Â  Â  <button id="sendWindHButton" disabled>çœŸã®é¢¨å‘Hã‚’é€ã‚‹</button>Â Â  Â Â 

Â  Â  <div id="sensorContainer">
Â  Â  Â  Â  <div id="compassWindow">
Â  Â  Â  Â  Â  Â  <strong>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ–¹ä½ (æœªè£œæ­£ / è£œæ­£æ¸ˆã¿)</strong>
Â  Â  Â  Â  Â  Â  <p id="headingRealtime">--</p>
Â  Â  Â  Â  Â  Â  <p id="headingCorrected">---</p>
Â  Â  Â  Â  Â  Â  <p style="font-size: 1em; margin-top: 10px;">
Â  Â  Â  Â  Â  Â  Â  Â  **è¨˜éŒ²ã•ã‚ŒãŸèª¤å·®**: <span id="recordedErrorDisplay">æœªè¨˜éŒ²</span>
Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  <p style="font-size: 1em;" id="compassStatus">ã‚»ãƒ³ã‚µãƒ¼ã¯åœæ­¢ä¸­ã§ã™ã€‚</p>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="windHWindow">
Â  Â  Â  Â  Â  Â  <strong>ğŸ¯ è£œæ­£æ¸ˆã¿ é¢¨å‘H (çœŸæ–¹ä½)</strong>
Â  Â  Â  Â  Â  Â  <p id="windHResultDisplay">---</p>
Â  Â  Â  Â  Â  Â  <p style="font-size: 1em;">
Â  Â  Â  Â  Â  Â  Â  Â  ï¼ˆã€Œé¢¨å‘Hã‚’å–å¾—ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰
Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  </div>
Â  Â  </div>


Â  Â  <div id="map"></div>

Â  Â  <script>
Â  Â  Â  Â  const API_KEY = "AIzaSyAHhxSJK-IhYiT9XBRwE1MX7DHhghBQQQk";Â 

Â  Â  Â  Â  const B_POINTS = { kinjo: { lat: 26.4454055, lng: 127.9209787, name: "é‡‘æ­¦ç«åŠ›ç™ºé›»æ‰€ (Bç‚¹)" },
Â  Â  Â  Â  Â  Â  gushikawa: { lat: 26.3803176, lng: 127.8751869, name: "å…·å¿—å·ç«åŠ›ç™ºé›»æ‰€ (Bç‚¹)" }
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  let map;
Â  Â  Â  Â  let currentOriginA = null;
Â  Â  Â  Â  let currentDestinationB = null;
Â  Â  Â  Â  let mapTapMode = false;
Â  Â  Â  Â Â 
Â  Â  Â  Â  let markerA = null;
Â  Â  Â  Â  let markerB = null;
Â  Â  Â  Â  let polyline = null;

Â  Â  Â  Â  let lastReadHeading = null;Â 
Â  Â  Â  Â  let isCompassRunning = false;Â 
Â  Â  Â  Â  let recordedError = null; // è¨˜éŒ²ã•ã‚ŒãŸèª¤å·®ã‚’ä¿æŒã™ã‚‹ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
Â  Â  Â  Â  let correctedWindHeadingResult = null; // è£œæ­£å¾Œã®é¢¨å‘Hã‚’ä¿æŒ


Â  Â  Â  Â  // --- ã‚»ãƒ³ã‚µãƒ¼é–¢é€£ã®é–¢æ•° ---
Â  Â  Â  Â Â 
Â  Â  Â  Â  function toggleCompass() {
Â  Â  Â  Â  Â  Â  const statusDiv = document.getElementById('compassStatus');
Â  Â  Â  Â  Â  Â  const startButton = document.getElementById('startCompassButton');
Â  Â  Â  Â  Â  Â  const captureButton = document.getElementById('captureHeadingButton');
Â  Â  Â  Â  Â  Â  const windHButton = document.getElementById('captureWindHButton');Â 
Â  Â  Â  Â  Â  Â  const copyButton = document.getElementById('copyWindHButton'); // ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³
Â  Â  Â  Â  Â  Â  const sendButton = document.getElementById('sendWindHButton'); // â˜…â˜…â˜…è¿½åŠ â˜…â˜…â˜…

Â  Â  Â  Â  Â  Â  if (isCompassRunning) {
Â  Â  Â  Â  Â  Â  Â  Â  // åœæ­¢å‡¦ç†
Â  Â  Â  Â  Â  Â  Â  Â  window.removeEventListener('deviceorientation', handleOrientation);
Â  Â  Â  Â  Â  Â  Â  Â  isCompassRunning = false;
Â  Â  Â  Â  Â  Â  Â  Â  startButton.textContent = 'æ–¹ä½ã‚»ãƒ³ã‚µãƒ¼ã‚’é–‹å§‹';
Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.textContent = 'ã‚»ãƒ³ã‚µãƒ¼ã¯åœæ­¢ä¸­ã§ã™ã€‚';
Â  Â  Â  Â  Â  Â  Â  Â  captureButton.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  windHButton.disabled = true;Â 
Â  Â  Â  Â  Â  Â  Â  Â  copyButton.disabled = true; // åœæ­¢æ™‚ã¯ç„¡åŠ¹åŒ–
Â  Â  Â  Â  Â  Â  Â  Â  sendButton.disabled = true; // â˜…â˜…â˜…è¿½åŠ â˜…â˜…â˜…
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('headingRealtime').textContent = '--';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('headingCorrected').textContent = '---';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // é–‹å§‹å‡¦ç†
Â  Â  Â  Â  Â  Â  Â  Â  if (typeof DeviceOrientationEvent.requestPermission === 'function') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  DeviceOrientationEvent.requestPermission()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .then(permissionState => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (permissionState === 'granted') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  startSensorLogic(startButton, statusDiv, captureButton, windHButton, copyButton, sendButton); // â˜…â˜…â˜…å¤‰æ›´â˜…â˜…â˜…
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.textContent = 'ã‚»ãƒ³ã‚µãƒ¼åˆ©ç”¨ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸã€‚è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .catch(console.error);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  startSensorLogic(startButton, statusDiv, captureButton, windHButton, copyButton, sendButton); // â˜…â˜…â˜…å¤‰æ›´â˜…â˜…â˜…
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function startSensorLogic(startButton, statusDiv, captureButton, windHButton, copyButton, sendButton) { // â˜…â˜…â˜…å¤‰æ›´â˜…â˜…â˜…
Â  Â  Â  Â  Â  Â  window.addEventListener('deviceorientation', handleOrientation);
Â  Â  Â  Â  Â  Â  isCompassRunning = true;
Â  Â  Â  Â  Â  Â  startButton.textContent = 'æ–¹ä½ã‚»ãƒ³ã‚µãƒ¼ã‚’åœæ­¢';
Â  Â  Â  Â  Â  Â  statusDiv.textContent = 'ã‚»ãƒ³ã‚µãƒ¼ç¨¼åƒä¸­ã€‚';
Â  Â  Â  Â  Â  Â  captureButton.disabled = false;
Â  Â  Â  Â  Â  Â  windHButton.disabled = false;Â 
Â  Â  Â  Â  Â  Â  if (correctedWindHeadingResult === null) {
Â  Â  Â  Â  Â  Â  Â  Â  Â copyButton.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â sendButton.disabled = true; // â˜…â˜…â˜…è¿½åŠ â˜…â˜…â˜…
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â copyButton.disabled = false; // ä»¥å‰ã®è¨˜éŒ²ãŒã‚ã‚Œã°æœ‰åŠ¹åŒ–
Â  Â  Â  Â  Â  Â  Â  Â  Â sendButton.disabled = false; // â˜…â˜…â˜…è¿½åŠ â˜…â˜…â˜…
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function handleOrientation(event) {
Â  Â  Â  Â  Â  Â  if (event.alpha === null) return;
Â  Â  Â  Â  Â  Â  lastReadHeading = (360 - event.alpha + 360) % 360;Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('headingRealtime').textContent = `${lastReadHeading.toFixed(1)}Â°`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // è£œæ­£æ©Ÿèƒ½ã®é©ç”¨ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤ºï¼‰
Â  Â  Â  Â  Â  Â  if (recordedError !== null) {
Â  Â  Â  Â  Â  Â  Â  Â  let correctedHeading = lastReadHeading - recordedError;
Â  Â  Â  Â  Â  Â  Â  Â  correctedHeading = (correctedHeading % 360 + 360) % 360;Â 

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('headingCorrected').textContent = `${correctedHeading.toFixed(1)}Â°`;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('compassStatus').textContent = `ã‚»ãƒ³ã‚µãƒ¼ç¨¼åƒä¸­ï¼ˆèª¤å·® ${recordedError.toFixed(2)}Â° è£œæ­£æ¸ˆã¿ï¼‰`;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('headingCorrected').textContent = '---';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('compassStatus').textContent = 'ã‚»ãƒ³ã‚µãƒ¼ç¨¼åƒä¸­ï¼ˆèª¤å·®æœªè¨˜éŒ²ã®ãŸã‚è£œæ­£ãªã—ï¼‰';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * é¢¨å‘Hã®æ–¹ä½ã‚’å–å¾—ã—ã€èª¤å·®ã‚’é©ç”¨ã—ã¦çµæœã‚’è¡¨ç¤ºã™ã‚‹
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function captureWindHeading() {
Â  Â  Â  Â  Â  Â  const windHDisplay = document.getElementById('windHResultDisplay');
Â  Â  Â  Â  Â  Â  const copyButton = document.getElementById('copyWindHButton');
Â  Â  Â  Â  Â  Â  const sendButton = document.getElementById('sendWindHButton'); // â˜…â˜…â˜…è¿½åŠ â˜…â˜…â˜…
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (lastReadHeading === null || !isCompassRunning) {
Â  Â  Â  Â  Â  Â  Â  Â  windHDisplay.textContent = 'ã‚»ãƒ³ã‚µãƒ¼ã‚’èµ·å‹•ã—ã€å€¤ã‚’èª­ã¿å–ã£ã¦ãã ã•ã„ã€‚';
Â  Â  Â  Â  Â  Â  Â  Â  copyButton.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  sendButton.disabled = true; // â˜…â˜…â˜…è¿½åŠ â˜…â˜…â˜…
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const rawWindHeading = lastReadHeading;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (recordedError === null) {
Â  Â  Â  Â  Â  Â  Â  Â  windHDisplay.innerHTML = `èª¤å·®æœªè¨˜éŒ²: ${rawWindHeading.toFixed(1)}Â°<br> (è£œæ­£ãªã—)`;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('windHWindow').style.borderColor = 'red';
Â  Â  Â  Â  Â  Â  Â  Â  copyButton.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  sendButton.disabled = true; // â˜…â˜…â˜…è¿½åŠ â˜…â˜…â˜…
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // èª¤å·®ã‚’å·®ã—å¼•ã„ã¦è£œæ­£å¾Œã®çœŸã®æ–¹ä½ã‚’è¨ˆç®—
Â  Â  Â  Â  Â  Â  let correctedWindHeading = rawWindHeading - recordedError;
Â  Â  Â  Â  Â  Â  correctedWindHeading = (correctedWindHeading % 360 + 360) % 360;

Â  Â  Â  Â  Â  Â  // è£œæ­£å¾Œã®å€¤ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ä¿å­˜ã—ã€ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
Â  Â  Â  Â  Â  Â  correctedWindHeadingResult = correctedWindHeading;
Â  Â  Â  Â  Â  Â  copyButton.disabled = false;
Â  Â  Â  Â  Â  Â  sendButton.disabled = false; // â˜…â˜…â˜…è¿½åŠ â˜…â˜…â˜…

Â  Â  Â  Â  Â  Â  windHDisplay.innerHTML = `${correctedWindHeading.toFixed(1)}Â°`;
Â  Â  Â  Â  Â  Â  document.getElementById('windHWindow').style.borderColor = '#007bff'; // æˆåŠŸè‰²
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('result').innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <h3>âœ… é¢¨å‘Hã®æ–¹ä½å–å¾—å®Œäº†</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <p>æœªè£œæ­£å€¤: ${rawWindHeading.toFixed(1)}Â°</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p>è¨˜éŒ²ã•ã‚ŒãŸèª¤å·®: ${recordedError.toFixed(2)}Â°</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>çœŸã®é¢¨å‘H (è£œæ­£å¾Œ):</strong> <span style="font-size: 2em; color: #d9534f;">${correctedWindHeading.toFixed(1)}Â°</span></p>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function copyWindH() {
Â  Â  Â  Â  Â  Â  if (correctedWindHeadingResult === null) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('å…ˆã«ã€Œé¢¨å‘Hã‚’å–å¾—ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦æ–¹ä½ã‚’æ±ºå®šã—ã¦ãã ã•ã„ã€‚');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const textToCopy = correctedWindHeadingResult.toFixed(1);

Â  Â  Â  Â  Â  Â  // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰APIã‚’ä½¿ç”¨ã—ã¦ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼
Â  Â  Â  Â  Â  Â  navigator.clipboard.writeText(textToCopy).then(() => {
Â  Â  Â  Â  Â  Â  Â  Â  const copyButton = document.getElementById('copyWindHButton');
Â  Â  Â  Â  Â  Â  Â  Â  const originalText = 'è£œæ­£æ¸ˆã¿é¢¨å‘Hã‚’ã‚³ãƒ”ãƒ¼';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  copyButton.textContent = 'âœ… ã‚³ãƒ”ãƒ¼å®Œäº†!';
Â  Â  Â  Â  Â  Â  Â  Â  copyButton.style.backgroundColor = '#28a745';

Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  copyButton.textContent = originalText;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  copyButton.style.backgroundColor = '#5cb85c';
Â  Â  Â  Â  Â  Â  Â  Â  }, 1500);

Â  Â  Â  Â  Â  Â  }).catch(err => {
Â  Â  Â  Â  Â  Â  Â  Â  alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + err);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * è£œæ­£æ¸ˆã¿é¢¨å‘Hã‚’å¤–éƒ¨ã‚µã‚¤ãƒˆã«é€ä¿¡ã™ã‚‹ (â˜…â˜…â˜…è¿½åŠ ã•ã‚ŒãŸé–¢æ•°â˜…â˜…â˜…)
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function sendWindH() {
Â  Â  Â  Â  Â  Â  if (correctedWindHeadingResult === null) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('å…ˆã«ã€Œé¢¨å‘Hã‚’å–å¾—ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦æ–¹ä½ã‚’æ±ºå®šã—ã¦ãã ã•ã„ã€‚');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const valueToSend = correctedWindHeadingResult.toFixed(1);
Â  Â  Â  Â  Â  Â  // ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ 'heading' ã«å€¤ã‚’æ¸¡ã™
Â  Â  Â  Â  Â  Â  const targetUrl = `https://popolopoint.github.io/windmap/windmap_v5.1.1.html?heading=${valueToSend}`;

Â  Â  Â  Â  Â  Â  // æ–°ã—ã„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¾ãŸã¯ã‚¿ãƒ–ã§é–‹ã
Â  Â  Â  Â  Â  Â  window.open(targetUrl, '_blank');

Â  Â  Â  Â  Â  Â  const sendButton = document.getElementById('sendWindHButton');
Â  Â  Â  Â  Â  Â  const originalText = 'çœŸã®é¢¨å‘Hã‚’é€ã‚‹';
Â  Â  Â  Â  Â  Â  const originalColor = '#6610f2'; // æ–°ã—ãå®šç¾©ã—ãŸè‰²

Â  Â  Â  Â  Â  Â  // ä¸€æ™‚çš„ã«ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºã‚’å¤‰æ›´ã—ã¦ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
Â  Â  Â  Â  Â  Â  sendButton.textContent = 'ğŸ“¤ é€ä¿¡å®Œäº†!';
Â  Â  Â  Â  Â  Â  sendButton.style.backgroundColor = '#28a745'; // æˆåŠŸè‰² (setLocationButtonã¨åŒã˜)

Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  sendButton.textContent = originalText;
Â  Â  Â  Â  Â  Â  Â  Â  sendButton.style.backgroundColor = originalColor;
Â  Â  Â  Â  Â  Â  }, 1500);
Â  Â  Â  Â  }


Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Bç‚¹ã«ã‚¹ãƒãƒ›ã‚’å‘ã‘ã¦æ–¹ä½ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã€èª¤å·®ã‚’è¨ˆç®—ãƒ»è¨˜éŒ²ã™ã‚‹
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function captureHeading() {
Â  Â  Â  Â  Â  Â  if (lastReadHeading === null || !currentOriginA || !currentDestinationB) {
Â  Â  Â  Â  Â  Â  Â  Â  Â document.getElementById('result').innerHTML = `<h3>âŒ è¨˜éŒ²å¤±æ•—</h3><p style="color: red;">Aç‚¹/Bç‚¹ã®è¨­å®šã¾ãŸã¯ã‚»ãƒ³ã‚µãƒ¼å€¤ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const capturedValue = lastReadHeading;
Â  Â  Â  Â  Â  Â  const trueBearing = calculateBearing(currentOriginA.lat(), currentOriginA.lng(), currentDestinationB.lat(), currentDestinationB.lng());
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // èª¤å·®ã‚’è¨ˆç®—ã—ã€æ­£è¦åŒ–
Â  Â  Â  Â  Â  Â  let error = capturedValue - trueBearing;
Â  Â  Â  Â  Â  Â  if (error > 180) { error -= 360; } else if (error < -180) { error += 360; }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // èª¤å·®ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«è¨˜éŒ²
Â  Â  Â  Â  Â  Â  recordedError = error;Â 
Â  Â  Â  Â  Â  Â  document.getElementById('recordedErrorDisplay').textContent = `${recordedError.toFixed(2)}Â°`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let bName = markerB ? markerB.getTitle() : 'ã‚¿ãƒƒãƒ—ä½ç½®';

Â  Â  Â  Â  Â  Â  // çµæœè¡¨ç¤ºã®æ›´æ–°
Â  Â  Â  Â  Â  Â  document.getElementById('result').innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <h3>âœ… ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†ï¼ˆèª¤å·®ã‚’è¨˜éŒ²ï¼‰</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Aç‚¹ã‹ã‚‰è¦‹ãŸBç‚¹ã®æ–¹ä½ (çœŸã®æ–¹ä½):</strong>Â 
Â  Â  Â  Â  Â  Â  Â  Â  <span style="color: #337ab7; font-weight: bold;">${trueBearing.toFixed(2)}Â°</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>è¨˜éŒ²ã•ã‚ŒãŸæ–¹ä½ (æ±ºå®šå€¤):</strong>Â 
Â  Â  Â  Â  Â  Â  Â  Â  <span style="color:#d9534f">${capturedValue.toFixed(2)}Â°</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  <p style="font-size: 1.5em; color: #FF6347; font-weight: bold;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ§­ è¨˜éŒ²ã•ã‚ŒãŸã‚³ãƒ³ãƒ‘ã‚¹èª¤å·®: ${error.toFixed(2)}Â°
Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  // è£œæ­£å¾Œã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤ºã‚’ãƒˆãƒªã‚¬ãƒ¼
Â  Â  Â  Â  Â  Â  handleOrientation({ alpha: (360 - capturedValue) % 360 });Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- åœ°ç†çš„ãªæ–¹ä½è¨ˆç®— (å‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨åŒã˜) ---
Â  Â  Â  Â Â 
Â  Â  Â  Â  function calculateBearing(startLat, startLng, endLat, endLng) {
Â  Â  Â  Â  Â  Â  const R_startLat = startLat * (Math.PI / 180);
Â  Â  Â  Â  Â  Â  const R_endLat = endLat * (Math.PI / 180);
Â  Â  Â  Â  Â  Â  const deltaLng = (endLng - startLng) * (Math.PI / 180);

Â  Â  Â  Â  Â  Â  const y = Math.sin(deltaLng) * Math.cos(R_endLat);
Â  Â  Â  Â  Â  Â  const x = Math.cos(R_startLat) * Math.sin(R_endLat) -Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Math.sin(R_startLat) * Math.cos(R_endLat) * Math.cos(deltaLng);

Â  Â  Â  Â  Â  Â  let bearingRad = Math.atan2(y, x);
Â  Â  Â  Â  Â  Â  let bearingDeg = bearingRad * (180 / Math.PI);

Â  Â  Â  Â  Â  Â  return (bearingDeg + 360) % 360;
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- ãƒãƒƒãƒ—æ“ä½œãƒ­ã‚¸ãƒƒã‚¯ (ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¿½åŠ ä»¥å¤–ã¯å‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨åŒã˜) ---
Â  Â  Â  Â Â 
Â  Â  Â  Â  function initMap() {
Â  Â  Â  Â  Â  Â  Â map = new google.maps.Map(document.getElementById('map'), {
Â  Â  Â  Â  Â  Â  Â  Â  zoom: 12, center: B_POINTS.kinjo,
Â  Â  Â  Â  Â  Â  });


Â  Â  Â  Â  Â  Â  document.getElementById('setLocationButton').addEventListener('click', findCurrentLocation);
Â  Â  Â  Â  Â  Â  document.getElementById('startCompassButton').addEventListener('click', toggleCompass);
Â  Â  Â  Â  Â  Â  document.getElementById('captureHeadingButton').addEventListener('click', captureHeading);Â 
Â  Â  Â  Â  Â  Â  document.getElementById('captureWindHButton').addEventListener('click', captureWindHeading);Â 
Â  Â  Â  Â  Â  Â  document.getElementById('copyWindHButton').addEventListener('click', copyWindH);Â 
Â  Â  Â  Â  Â  Â  document.getElementById('sendWindHButton').addEventListener('click', sendWindH); // â˜…â˜…â˜…è¿½åŠ â˜…â˜…â˜…
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementsByName('b_option').forEach(radio => {
Â  Â  Â  Â  Â  Â  Â  Â  radio.addEventListener('change', handleBSelectionChange);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  map.addListener('click', handleMapClick);

Â  Â  Â  Â  Â  Â  setDestinationB(B_POINTS.kinjo);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function handleBSelectionChange(event) {
Â  Â  Â  Â  Â  Â  const selectedValue = event.target.value;
Â  Â  Â  Â  Â  Â  document.getElementById('bTapInstruction').style.display = 'none';
Â  Â  Â  Â  Â  Â  mapTapMode = false;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (selectedValue === 'tap') {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('bTapInstruction').style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  currentDestinationB = null;
Â  Â  Â  Â  Â  Â  Â  Â  mapTapMode = true;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  setDestinationB(B_POINTS[selectedValue]);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (currentOriginA) { displayCalculatedBearing(); }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function handleMapClick(event) {
Â  Â  Â  Â  Â  Â  if (mapTapMode) {
Â  Â  Â  Â  Â  Â  Â  Â  setDestinationB({ lat: event.latLng.lat(), lng: event.latLng.lng(), name: "ãƒãƒƒãƒ—ã‚¿ãƒƒãƒ—ä½ç½® (Bç‚¹)" });
Â  Â  Â  Â  Â  Â  Â  Â  mapTapMode = false;
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector('input[name="b_option"][value="tap"]').checked = true;
Â  Â  Â  Â  Â  Â  Â  Â  if (currentOriginA) { displayCalculatedBearing(); }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function setDestinationB(coords) {
Â  Â  Â  Â  Â  Â  currentDestinationB = new google.maps.LatLng(coords.lat, coords.lng);
Â  Â  Â  Â  Â  Â  if (markerB) { markerB.setPosition(currentDestinationB); markerB.setTitle(coords.name); }Â 
Â  Â  Â  Â  Â  Â  else { markerB = new google.maps.Marker({ position: currentDestinationB, map: map, title: coords.name, label: 'B', }); }
Â  Â  Â  Â  Â  Â  if (currentOriginA) { updateMapDisplay(); } else { map.setCenter(currentDestinationB); }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function findCurrentLocation() {
Â  Â  Â  Â  Â  Â  document.getElementById('result').innerHTML = '<p class="loading">ç¾åœ¨åœ°ã‚’æ¤œå‡ºä¸­ã§ã™...</p>';
Â  Â  Â  Â  Â  Â  if (navigator.geolocation) {
Â  Â  Â  Â  Â  Â  Â  Â  navigator.geolocation.getCurrentPosition(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (position) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentOriginA = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (markerA) { markerA.setPosition(currentOriginA); }Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  markerA = new google.maps.Marker({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  position: currentOriginA, map: map, title: "ç¾åœ¨ä½ç½® (Aç‚¹)", label: 'A',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  icon: { path: google.maps.SymbolPath.CIRCLE, scale: 8, fillColor: '#007bff', fillOpacity: 1, strokeWeight: 0, }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateMapDisplay();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('setLocationButton').textContent = 'ç¾åœ¨ä½ç½®ã‚’Aç‚¹ã«è¨­å®š (æ›´æ–°)';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('result').innerHTML = `<h3>âœ… Aç‚¹è¨­å®šå®Œäº†</h3><p>ç¾åœ¨ä½ç½®ãŒAç‚¹ã¨ã—ã¦è¨­å®šã•ã‚Œã¾ã—ãŸã€‚</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayCalculatedBearing();Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (error) => { document.getElementById('result').innerHTML = `<h3>âŒ Aç‚¹è¨­å®šå¤±æ•—</h3><p style="color: red;">ä½ç½®æƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼ã€‚</p>`; }
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  } else { document.getElementById('result').innerHTML = `<h3>âŒ Aç‚¹è¨­å®šå¤±æ•—</h3><p style="color: red;">ãƒ–ãƒ©ã‚¦ã‚¶ãŒä½ç½®æƒ…å ±APIã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚</p>`; }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function updateMapDisplay() {
Â  Â  Â  Â  Â  Â  if (!currentOriginA || !currentDestinationB) { return; }
Â  Â  Â  Â  Â  Â  if (polyline) { polyline.setMap(null); }
Â  Â  Â  Â  Â  Â  polyline = new google.maps.Polyline({
Â  Â  Â  Â  Â  Â  Â  Â  path: [currentOriginA, currentDestinationB], geodesic: true, strokeColor: '#FF0000',
Â  Â  Â  Â  Â  Â  Â  Â  strokeOpacity: 1.0, strokeWeight: 2, map: map,
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  const bounds = new google.maps.LatLngBounds();
Â  Â  Â  Â  Â  Â  bounds.extend(currentOriginA);
Â  Â  Â  Â  Â  Â  bounds.extend(currentDestinationB);
Â  Â  Â  Â  Â  Â  map.fitBounds(bounds);
Â  Â  Â  Â  }

Â  Â  Â  Â  function displayCalculatedBearing() {
Â  Â  Â  Â  Â  Â  if (!currentOriginA || !currentDestinationB) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('result').innerHTML = `<h3>å¾…æ©Ÿä¸­...</h3><p>Aç‚¹ã¨Bç‚¹ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const trueBearing = calculateBearing(currentOriginA.lat(), currentOriginA.lng(), currentDestinationB.lat(), currentDestinationB.lng());
Â  Â  Â  Â  Â  Â  let bName = markerB ? markerB.getTitle() : 'ã‚¿ãƒƒãƒ—ä½ç½®';
Â  Â  Â  Â  Â  Â  const calibrationMessage = recordedError !== null ?Â 
Â  Â  Â  Â  Â  Â  Â  Â  `<span style="color: green; font-weight: bold;">èª¤å·® ${recordedError.toFixed(2)}Â° è¨˜éŒ²æ¸ˆã¿ã€‚</span>` :Â 
Â  Â  Â  Â  Â  Â  Â  Â  `**æ–¹ä½ã‚’æ±ºå®š**ã—ã¦èª¤å·®ã‚’è¨˜éŒ²ã—ã¦ãã ã•ã„ã€‚`;

Â  Â  Â  Â  Â  Â  document.getElementById('result').innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <h3>âœ… æ–¹ä½è¨ˆç®—çµæœ</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Aç‚¹ã‹ã‚‰è¦‹ãŸBç‚¹ã®æ–¹ä½ (çœŸã®æ–¹ä½):</strong>Â 
Â  Â  Â  Â  Â  Â  Â  Â  <span style="font-size: 1.5em; color: #337ab7; font-weight: bold;">${trueBearing.toFixed(2)}Â°</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  <p>${calibrationMessage}</p>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }

Â  Â  </script>

Â  Â  <script async defer
Â  Â  Â  Â  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAHhxSJK-IhYiT9XBRwE1MX7DHhghBQQQk&callback=initMap">
Â  Â  </script>
</body>
</html>