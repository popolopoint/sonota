<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wind Direction on Google Maps</title>
<style>
  #map { height: 100vh; width: 100vw; }
  #windControl {
    position: absolute;
    top: 10px; left: 10px;
    background: white;
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  }
</style>
</head>

<body>
<div id="windControl">
  <label>風向（度）: </label>
  <input id="windDeg" type="number" min="0" max="359" value="0">
  <button onclick="updateWind()">更新</button>
</div>
<div id="map"></div>

<script>
let map;
let windArrow;

// ▼ SVG矢印（確実に表示される）
const arrowSVG =
  "data:image/svg+xml;utf8," +
  "<svg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 100 100'>" +
  "<polygon points='50,0 90,100 50,80 10,100' fill='red' stroke='black' stroke-width='3'/>" +
  "</svg>";

function initMap() {
  map = new google.maps.Map(document.getElementById("map"), {
    center: { lat: 26.337, lng: 127.900 },
    zoom: 15,
  });

  // ▼ 確実に表示される marker
  windArrow = new google.maps.Marker({
    position: map.getCenter(),
    map: map,
    icon: {
      url: arrowSVG,
      scaledSize: new google.maps.Size(80, 80),
      rotation: 0,   // ← 回転できるように拡張
      anchor: new google.maps.Point(40, 40)
    }
  });
}

// ▼ 風向を更新（回転）
function updateWind() {
  const deg = Number(document.getElementById("windDeg").value);

  windArrow.setIcon({
    url: arrowSVG,
    scaledSize: new google.maps.Size(80, 80),
    // ▼ Maps の仕様として rotation は "marker" では効かない
    //   → ここでは "label" を使って回転させる方法に切り替える
  });

  windArrow.setLabel({
    text: "",
    color: "transparent",
    fontSize: "0px",
    // ▼ 回転させるCSS
    className: "rotate"
  });

  // ▼ 実際のCSS回転を適用
  const markerDiv = document.querySelector("img[src^='data:image']");
  if (markerDiv) {
    markerDiv.style.transform = `rotate(${deg}deg)`;
  }
}
</script>

<style>
/* アイコンをCSSで回転できるようにする */
.rotate img {
  transform-origin: center center;
}
</style>

<script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAHhxSJK-IhYiT9XBRwE1MX7DHhghBQQQk&callback=initMap"></script>

</body>
</html>
